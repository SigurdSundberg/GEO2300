If you are copying any of this, ignore everything regarding tridiag solvers.
